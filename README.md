# Twitter

## 1. Тема и целевая аудитория
### 1.1. Тема
[Twitter](https://twitter.com/) — американский сервис микроблогов и социальная сеть, в которой пользователи публикуют сообщения, известные как «твиты», и взаимодействуют с ними.

### 1.2. Целевая аудитория

| Целевая аудитория (значения за прошедший месяц - сентябрь) | Количество |
|-|-|
| Количество посетителей сайта в месяц [[1]](https://pro.similarweb.com/#/digitalsuite/websiteanalysis/overview/website-performance/*/999/1m?webSource=Total&key=twitter.com)| 6,8 млрд |
| Количество посетителей сайта в день [[2]](https://www.statista.com/statistics/970920/monetizable-daily-active-twitter-users-worldwide/) (статистика за второй квартал 2022 года)| 237,8 млн |
| Среднее количество страниц за визит [[1]](https://www.similarweb.com/ru/website/twitter.com/#traffic)| 10,39 |
| Среднее время просмотра [[1]](https://www.similarweb.com/ru/website/twitter.com/#traffic)| 10м 58с  |

| Распределение пользователей по миру (топ-5) за прошедший месяц[[1]](https://pro.similarweb.com/#/digitalsuite/websiteanalysis/overview/website-performance/*/999/1m?webSource=Total&key=twitter.com)   | % |
|-----------------------------------|-----------|
| Соединенные Штаты Америки | 25,33 |
| Япония | 15,40 |
| Великобритания | 5,47 |
| Бразилия | 3,94 |
| Канада | 3,02 |
| Остальное страны | 46,84 |

### 1.3. MVP
Минимальные требования для MVP:
* Регистрация и авторизация пользователя;
* Публикация твита
    * Максимальное количество прикрепленных вложений - 4 [[3]](https://help.twitter.com/ru/using-twitter/tweeting-gifs-and-pictures#:~:text=%D0%9A%20%D0%BE%D0%B4%D0%BD%D0%BE%D0%BC%D1%83%20%D1%82%D0%B2%D0%B8%D1%82%D1%83%20%D0%BC%D0%BE%D0%B6%D0%BD%D0%BE%20%D0%BF%D1%80%D0%B8%D0%BA%D1%80%D0%B5%D0%BF%D0%B8%D1%82%D1%8C%20%D0%B4%D0%BE%204%C2%A0%D1%84%D0%BE%D1%82%D0%BE%D0%B3%D1%80%D0%B0%D1%84%D0%B8%D0%B9.);
    * Максимальная длина сообщения - 280 символов [[4]](https://developer.twitter.com/en/docs/counting-characters#:~:text=In%20most%20cases%2C%20the%20text%20content%20of%20a%20Tweet%20can%20contain%20up%20to%20280%20characters%20or%20Unicode%20glyphs) ;
    * Максимальный размер прикрепленных вложений - 5 mb [[5]](https://help.twitter.com/en/using-twitter/tweeting-gifs-and-pictures#:~:text=Photos%20can%20be%20up%20to%205MB%3B%20animated%20GIFs%20can%20be%20up%20to%205MB%20on%20mobile%2C%20and%20up%20to%2015MB%20on%20web.).
* Проставление лайков
* Просмотр ленты (твитов)

## 2. Расчет нагрузки
### 2.1. Продуктовые метрики

#### 2.1.1 Регистрация и авторизация
Основываясь на данных из источника [[2]](https://www.statista.com/statistics/970920/monetizable-daily-active-twitter-users-worldwide/) (статистика за второй квартал 2022 года), количество пользователей в день составляется 237,8 млн. По аппроксимирующей статистике [[6]](https://www.statista.com/statistics/303681/twitter-users-worldwide/) суммарное количество пользователей твиттера за 2021 год составляло 322,4 млн, а за 2022 год - 329 млн. Значит, за 2022 год приблизительное значение зарегистрировашихся пользователей составит 6,6 млн. Значит, в день будет регистрироваться примерно:

`6,6 * 10 ^ 6 / 365 = 18,082 тыс в день`

Суммирая авторизацию и регистрацию, получаем около 238 млн/день.

#### 2.1.2 Публикация твита
По статистике, приведенной в источнике [[7]](https://www.loginradius.com/blog/engineering/handling-cheapest-fuel-data/#:~:text=Twitter%3A%20456%2C000%20tweets%20sent%20or%20created), в минуту создается порядка 456 тыс. твитов. Исходя из этого, можно сделать вывод, что в день создается: 

`456 * 10 ^ 3 *60 * 24 = 656,64 млн в день`
#### 2.1.3 Проставление лайков
По статистике [[7]](https://follows.com/blog/2022/01/how-tweets-safe-day#:~:text=Favorites%20(now%20likes)%20seemed%20to%20have%20a%20limit%20of%20about%201%2C000%20per%20day) (сомнительный источник, официальной информации нет) пользователю в день разрешено проставлять 1000 лайков. Проставление лайков - не особо популярная функция. Учитывая, что, как и в других популярных соц. сетях, в Твиттере также есть боты, можно сказать, что 10 лайков в день - средний показатель по пользователям. Исходя их этого, можно сделать вывод, что в день проставляется лайков:

`10 * 237,8 ^ 10 * 6 = 2,37 млрд в день`
#### 2.1.4 Просмотр ленты
Лента загружается через запрос к API по следующему URL: "https://twitter.com/i/api/2/timeline/home.json...", где далее расположены query-параметры запроса. Количество загружаемых постов варьировалось от просмотра ленты:
* При первой загрузке страницы было загружено 27 твитов;
* Следующая загрузка - 36 твитов;
* Третья загрузка - 38 твитов;
* Четвертая загрузка - 43 твита.

Наблюдается зависимость: при большем просмотре твитов увеличивается количество загружаемых твитов в одном запросе. В среднем, в следующем запросе количество твитов увеличивается на 4.

Средняя скорость чтения человека - 200 слов в минуту [[8]](https://ru.wikipedia.org/wiki/%D0%A1%D0%BA%D0%BE%D1%80%D0%BE%D1%87%D1%82%D0%B5%D0%BD%D0%B8%D0%B5#:~:text=%D1%81%D1%80%D0%B5%D0%B4%D0%BD%D1%8F%D1%8F%20%D1%81%D0%BA%D0%BE%D1%80%D0%BE%D1%81%D1%82%D1%8C%20%D1%80%D0%B0%D0%B2%D0%BD%D1%8F%D0%B5%D1%82%D1%81%D1%8F%20201%20%D1%81%D0%BB%D0%BE%D0%B2%D1%83%20%D0%B2%20%D0%BC%D0%B8%D0%BD%D1%83%D1%82%D1%83), что равняется 1400 знакам. Человек может обрабатывать от 10 до 12 изображений в секунду [[9]](https://en.wikipedia.org/wiki/Frame_rate#:~:text=can%20process%2010%20to%2012%20images%20per%20second). Значит, среднее время просмотра одного твита - около 15 секунд. Как было выяснено в пункте ["Целевая аудитория"](#12-целевая-аудитория) пользователь тратит в среднем 10 минут 58 секунд в день, используя Твиттер. За это время пользователь мог бы посмотреть 44 твита, если бы останавливал свое внимание на каждом. Допустим, что каждый 3 твит был пропущен, тогда пользователь просмотрит в день порядка 90 твитов. Ориентируясь на количество твитов в загрузках, в среднем пользователю понадобится 3 загрузки твитов. 
Посчитаем количество запросов в день:

`3 * 237,8 (количество пользователей в день) = 713,4 млн`

#### Сводная таблица количества действий пользователя по типам в день
| Тип запроса | Среднее количество в день|
|-|-|
| Регистрация и авторизация | 238 млн |
| Публикация твита  | 656,64 млн |
| Проставление лайков | 2,378 млрд |
| Просмотр ленты | 713,4 млн |

### 2.2. Технические метрики
#### 2.2.1 Размер хранения
Рассчитаем размер одного твита. Один символ занимает один байт памяти. Предположим, что длиная среднего твита - 120 символов. Пользователи твиттера редко прикрепляют фотографии к твитам, поэтому предположим, что на один пост полагается порядка 0,8 фотографии. При максимальном значении одного вложения в 5 Мб предположим, что размер вложения будет 3,5 Мб. Таким образом, средний размер поста:

`3,5 * 0,8 + 120 / (1024 * 1024) = 2,9 Мб`

По данным статьи [[10]](https://www.renolon.com/number-of-tweets-per-day/#:~:text=How%20Many%20Tweet%20Sent%20Per%20Day%20of%202013%2D2022) суммарное количество твитов составляет: 

`340 + 500 + 546 + 592 + 634 + 683 + 729 + 775 + 821 + 867 = 6,487 млрд`

Тогда размер хранилища для твитов составит:

`6,487 * 10 ^ 9 * 2,9 = 1,88 * 10 ^ 10 Мб = 17,52 Пб`

Помимо твитов, место в хранилище занимает профили пользователей, их контактные данные, аватарка профиля, список твитов.

| Поле | Занимаемое место на диске|
|-|-|
| Id | 4 байта |
| Никнейм | 30 символов = 30 байт |
| Хешированный пароль | 32 байта |
| Почтовый адрес | 4 байта |
| Id | 30 символов = 30 байт |
| Фото профиля | 300 х 300, webp =  9 кБ|
| Список твитов | id, сам твит, указание 5 вложений - int, 6 * string = 259 байт * 100 (среднее кол-во твитов) |
| Список лайков | id, user_id, tweew_id = 3 * int = 12 байт|
| Суммарно | 46,3 кБ |

Общее количество пользователей Твиттера - 1,3 млрд [[11]](https://ru.wikipedia.org/wiki/%D0%A2%D0%B2%D0%B8%D1%82%D1%82%D0%B5%D1%80#:~:text=1%2C3%20%D0%BC%D0%BB%D1%80%D0%B4%20(%D0%B7%D0%B0%D1%80%D0%B5%D0%B3%D0%B8%D1%81%D1%82%D1%80%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%BD%D1%8B%D1%85)).

Тогда размер хранилища для пользователей составит: 

`46,3 * 1,3 * 10 ^ 9 = 56,06 Тб`


#### 2.2.2 Сетевой трафик
Твиттер генерирует порядка 12 ТерраБайт новых данных в день [[11]](https://www.loginradius.com/blog/engineering/handling-cheapest-fuel-data/). Тогда, нагрузка в секунду составит: `12 000 / 24 * 60 * 60 = 0.138 Gb/sec` 

#### 2.2.3 RPS
##### 2.2.3.1 Регистрация и авторизация
Основываясь на данных из [таблицы](#сводная-таблица-количества-действий-пользователя-по-типам-в-день), rps по регистрации и авторизации:

* Расчет RPS =`238 / (60 * 60 * 24) = 2754 rps`

##### 2.2.3.2 Публикация твита
Основываясь на данных из [таблицы](#сводная-таблица-количества-действий-пользователя-по-типам-в-день), rps по публикации твита:

* Расчет RPS = `656,64 * 10 ^ 6 / 24 * 60 * 60 = 7600 rps`

##### 2.2.3.3 Проставление лайков

Основываясь на данных из [таблицы](#сводная-таблица-количества-действий-пользователя-по-типам-в-день), rps по публикации твита:

* Расчет RPS = `2,378 * 10 ^ 9 / 24 * 60 * 60 = 27523 rps`
##### 2.2.3.4 Просмотр ленты
Основываясь на данных из [таблицы](#сводная-таблица-количества-действий-пользователя-по-типам-в-день), rps по публикации твита:

* Расчет RPS = `713,4 * 10 ^ 6 / 24 * 60 * 60 = 8256 rps`

#### RPS по типам запросов
| Тип запроса | RPS |
|-|-|
| Регистрация и авторизация | 2754 |
| Публикация твита | 7600 |
| Проставление лайков | 27523 |
| Просмотр ленты  | 8256 |
